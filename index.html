<!DOCTYPE html>
<html lang="en">

<!-- The following code has been developed by students and/or researchers of the Freshman Research Initiative, DIY Diagnostics Stream at The University of Texas at Austin.  This code is shared for demonstration purposes and should not be considered a product -- it is for entertainment purposes only.  Any user of this code does so at their own risk. Members of the DIY Stream, FRI, and The University of Texas system are not liable for anything related to this code.
 
  THIS CODE SHOULD NOT BE USED TO DIAGNOSE ANY KIND OF MEDICAL CONDITION.
 
  Further Information:
  http://cns.utexas.edu/fri
 
  Research Educator:
  Timothy E. Riedel
  triedel@utexas.edu
 
  Authors in chronological order of contribution:
  Author 1: Yun Cheng
  Author 2: Rachel Kim
  
  References:
  http://docs.webplatform.org/wiki/concepts/programming/drawing_images_onto_canvas#Loading_the_image_programmatically
  http://www.html5rocks.com/en/tutorials/file/dndfiles/
  http://www.w3.org/TR/FileAPI/
  http://mobilehtml5.org/
  http://stackoverflow.com/questions/11929099/html5-canvas-drawimage-ratio-bug-ios
  
  Brief Description of Goal of Code:
  Diagnose an insect bite through a series of survey questions.
 
  Known Issues:
  No known issues. 
-->

 <head>
  <meta charset="utf-8">
  <title>Photo Transform</title>
  <meta name="viewport" content="width=device-width, initial-scale=.7">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="stylesheet" href="https://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" /> 
  <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
  <script src="https://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
	 
	 


 <script>
	 
  var docMod = document.lastModified; // gets last modified date and time of the index.html file
  alert("This file last modified  " + docMod);
  console.log("This file last modified  " + docMod); // displays last modified date and time in the javascipt browser console 
 </script>
 <script>
/* detectVerticalSquash & drawImageIOSFix = are functions that are critical due to a flaw in the iPhone camera software that squishes any photos displayed on an HTML5 canvas element. https://github.com/stomita/ios-imagefile-megapixel
*/
 function detectVerticalSquash(img) {
  var iw = img.naturalWidth, ih = img.naturalHeight;
  var canvas = document.createElement('canvas');
  canvas.width = 1;
  canvas.height = ih;
  var ctx = canvas.getContext('2d');
  ctx.drawImage(img, 0, 0);
  var data = ctx.getImageData(0, 0, 1, ih).data;
  var sy = 0;
  var ey = ih;
  var py = ih;
  while (py > sy) {
   var alpha = data[(py - 1) * 4 + 3];
   if (alpha === 0) {
    ey = py;
   } 
   else {
    sy = py;
   }
   py = (ey + sy) >> 1;
  }
  var ratio = (py / ih);
  return (ratio===0)?1:ratio;
 }
 function drawImageIOSFix(ctx, img, sx, sy, sw, sh, dx, dy, dw, dh) {
  var vertSquashRatio = detectVerticalSquash(img);
  ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh / vertSquashRatio);
 }
/* window.onload necessary to keep javascripts from running before the app gets a chance to load entirely. */
 window.onload = function() {
  var fileInput = document.getElementById('fileInput');
  var messageDisplayArea = document.getElementById('messageDisplayArea');
  /* fileInput.addEventListener looks for any change in the <input> tag indicating that the user has selected a file (picture). */
  fileInput.addEventListener('change', function(e) {
    var file = fileInput.files[0];
    var imageType = /image.*/;
    /* if (file.type.match(imageType)) checks that the selected file is indeed an image. */
    if (file.type.match(imageType)) {
      /* new FileReader(); and reader.onload start some kind of file reading process in javaScript. I do not understand why this is necessary although it may simply slow things down to let the image load. */
      var reader = new FileReader();
      reader.onload = function(e) {
        /* messageDisplayArea.innerHTML not needed but allows you to send a message at this point in the program. */
        messageDisplayArea.innerHTML = "You picked an image!";
        /* new Image() and img.onload start some kind of new image creation process in javaScript. I do not understand why this is necessary although it may simply slow things down to let the image load. */
        var img = new Image();
        img.onload = function() {
          /*This finally draws the image onto the first drawing canvas. The specific canvas is referred to by "context". This is established down in the HTML part of the file just under the first <canvas> tag. If we weren't worried about fixing an iPhone bug we would use context.drawImage(image, 0, 0, img.naturalWidth, img.naturalHeight, 0, 0, 600, 500) instead of drawImageIOSFix */
        
          drawImageIOSFix(context,img, 0, 0, img.naturalWidth, img.naturalHeight, 0, 0, 600, 500);
          /*  +++++++++++++++ BEGIN IMAGE PROCESSING +++++++++++++++ */
          /*  ++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
          /* PUT ANY CHANGES TO THE JAVASCRIPT HERE  */
	   } // end of img.onload
        
        img.src = reader.result;
      } //  end of reader.onload
      
        reader.readAsDataURL(file);
    } // end of the if statement checking that file is an image
        else
    {
      // this is what happens if the orignial file selected is not an image file
      messageDisplayArea.innerHTML = "File not supported!"
    } // end of the else statement if file in NOT an image
  }); // end of the fileInput.addEventListener function
 } // end of the window.onload function	
	 </script>

<script>
	var deerFlies = 0;
	var ticks = 0;
	var bees = 0;
	var chiggers = 0;
	var brownSpider = 0;
	var mosquitoes = 0;
	var bedBugs = 0;
	var fleas = 0;
	var fireAnts = 0;
	var blackSpider = 0;
		//all of these variables are set to 0 so that they will reset every time the app is launched.
	 
	 

	function deerFliesAdd(){
		deerFlies = deerFlies + 1;
	}
	function brownSpiderAdd(){
		brownSpider = brownSpider + 1;
	}
	function ticksAdd(){
		ticks = ticks + 1;
	}
	function beesAdd(){
		bees = bees + 1;
	}
	function chiggersAdd(){
		chiggers = chiggers + 1;
	}
	function mosquitoesAdd(){
		mosquitoes = mosquitoes + 1;
	}
	function bedBugsAdd(){
		bedBugs = bedBugs + 1;
	}
	function fleasAdd (){
		fleas = fleas + 1;
	}
	function fireAntsAdd (){
		fireAnts = fireAnts + 1;
	}
	function blackSpiderAdd (){
		blackSpider = blackSpider + 1;
	}
	function allAdd (){
		blackSpider = blackSpider + 1;
		brownSpider = brownSpider + 1;
		fireAnts = fireAnts + 1;
		deerFlies = deerFlies + 1;
		ticks = ticks + 1;
		bees = bees + 1;
		chiggers = chiggers + 1;
		mosquitoes = mosquitoes + 1;
		bedBugs = bedBugs + 1;
		fleas = fleas + 1;
	}
	
	// these functions above will add a count to the total every time a corresponding button is pressed during the survey.
	function CalcResults(){
		if (document.getElementById("leg").checked == true){
			  fleasAdd();chiggersAdd();mosquitoesAdd();
		}
		if (document.getElementById("arm").checked == true){
			  allAdd();
		}	  //adding to all of the variables, because this location is possible for all bites
		if (document.getElementById("fold").checked == true){
			  ticksAdd();fleasAdd();chiggersAdd();mosquitoesAdd();
		}
	  	if (document.getElementById("face").checked == true){
			  allAdd();
		}	  //adding to all because there isn't one unique insect that bites the face (in our set)
	  	if (document.getElementById("back").checked == true){
			  allAdd();
		}
	  	if (document.getElementById("torso").checked == true){
			  allAdd();
		}
	  	if (document.getElementById("neck").checked == true){
			  allAdd();
		}
		if (document.getElementById("bump").checked == true){
			  mosquitoesAdd();
		}
		if (document.getElementById("redspot").checked == true){
			  ticksAdd();
		}
	  	if (document.getElementById("mark").checked == true){
			  bedBugsAdd();
		}
	  	if (document.getElementById("cluster").checked == true){
			  bedBugsAdd();fleasAdd();chiggersAdd();
		}
	  	if (document.getElementById("line").checked == true){
			  bedBugsAdd();fleasAdd();
		}
	  	if (document.getElementById("stinger").checked == true){
			 beesAdd();
		}
		if (document.getElementById("tick").checked == true){
			  ticksAdd();
		}
	  	if (document.getElementById("bullrash").checked == true){
			  ticksAdd();
		}
	  	if (document.getElementById("blister").checked == true){
			  fireAntsAdd();
		}
	  	if (document.getElementById("puncmarks").checked == true){
			  blackSpiderAdd();
		}
	  	if (document.getElementById("blue").checked == true){
			  brownSpiderAdd();
		}
		if (document.getElementById("itch").checked == true){
			  mosquitoesAdd();fireAntsAdd();chiggersAdd();bedBugsAdd();fleasAdd();brownSpiderAdd();deerFliesAdd();
		}
		if (document.getElementById("pain").checked == true){
			  brownSpiderAdd();deerFliesAdd();fireAntsAdd();beesAdd();blackSpiderAdd();
		}
		if (document.getElementById("burn").checked == true){
			  fireAntsAdd();beesAdd();
		}
		if (document.getElementById("fever").checked == true){
			  brownSpiderAdd();
		}
	}	//for the above functions, it means that if a checkmark is checked, then it will add one to the insects listed after it.
		
		
			  
			  
	 function showResults() {
		 var bite_Count = Math.max(deerFlies,brownSpider,ticks,bees,chiggers,mosquitoes,bedBugs,fleas)
		 //document.getElementById("resultText").innerHTML = System.out.println(" The result of your bite is " + map.get(str(ticks))) + "Your max result count is " + biteid_Count;
		 // if bite count equals to the bite count of a specific bite then that will be the output result
		 var img = '';
		 if (bite_Count == brownSpider){
			 biteid = "black Spider";
			 	//the id will allow this to be called somewhere else
			 img = '<img src = "https://images.emedicinehealth.com/images/4453/4453-4474-10729-25040tn.jpg">';
			 	//an image is included so that the user wil be able to compare it to their own
		 } else if (bite_Count == blackSpider){
			 biteid = "Black Widow Spider"; 
			 img = '<img src = "https://img.webmd.com/dtmcms/live/webmd/consumer_assets/site_images/articles/health_tools/bad_bugs_slideshow/flickr_photo_of_black_window_bite.jpg?resize=646px:*&output-quality=100">';
		 } else if (bite_Count == fireAnts){
			 biteid = "Fire Ants";
			 img = '<img src = "https://cdn.ymaws.com/www.aocd.org/resource/resmgr/ddb_high/fire_ant_bite_1_high.jpg">';
		 } else if (bite_Count == deerFlies){
			 biteid = "Deer Flies"; 
			 img = '<img src = "https://edc2.healthtap.com/ht-staging/user_answer/avatars/2351502/large/open-uri20150712-8206-15ls90m.jpeg?1436669540">';
			 //not sure if this picture is accurate
		 } else if (bite_Count == ticks){
			 biteid = "Ticks";
			 img = '<img src = "https://images.medicinenet.com/images/appictures/tick-bites-s6-disease-signs.jpg">';
		 } else if (bite_Count == bees){
			 biteid = "Bees";
			 img = '<img src = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSxGdr49MrTVwR8NqyzzpLATj4m_ke-XfnAoCEYwaKRBLGM8nCHbg">';
		 } else if (bite_Count == chiggers){
			 biteid = "Chiggers";
			 img = '<img src = "https://img.webmd.com/dtmcms/live/webmd/consumer_assets/site_images/articles/health_tools/bad_bugs_slideshow/280_190_photo_of_chigger_bites_on_leg.jpg">';
		 } else if (bite_Count == mosquitoes){
		 	 biteid = "Mosquitoes";
			 img = '<img src = "https://images.agoramedia.com/everydayhealth/gcms/Why-Mosquito-Bites-Itch-and-How-to-Get-Relief-722x406.jpg">';
		 } else if (bite_Count == bedBugs){
			 biteid = "Bedbugs";
			 img = '<img src = "https://www.aad.org/Image%20Library/Main%20navigation/Public%20and%20patients/Diseases%20and%20treatments/Itchy%20skin/bed_bugs_landing.jpg">';
		 } else if (bite_Count == fleas){
		 	 biteid = "Fleas";
			 img = '<img src = "https://static.skinsight.com/dx/webAdult/fleaBite_79556_sm.jpg">';
		 }
	 
		 //calculations for the results will go here when we figure out the image analysis part
		 document.getElementById("resultText").innerHTML = " The result of your bite is " + biteid + " with a count score of " + bite_Count  ; 
		 	//call for the text (and variables)
		 document.getElementById("resultImg").innerHTML = img; 
		 	//call for the image
	 }
		// the code above is the function to show the results. It has the if statements to call results, and an image that corresponds with it. 
	 
</script>



<style> /* set styles of the content*/
	p {text-align:center;} /* set all paragraph to center aligned*/
	h1 {text-align:center;}  /* set all header 1 to center aligned*/
	h2 {text-align:center;}  /* set all header 2 to center aligned*/
	h4 {text-align:center;}  /* set all header 4 to center aligned*/
	
	
	img, object{
            max-height:90%;
        	max-width:90%;
        	}
		/* resizes the image so that it'll look the same */
	
		
</style>   
 </head>

 <body>
	  <input type='text' id="text1" onclick='javascript:toggleClass(this)' />
 <!-- Intro page -->
	<div data-role="page" id="intro">
		<!-- the layout of the website will be like a page. This page is labeled as intro so that the other pages can be differentiated from this one.-->
		<div data-role="header">
			<h1>Bug Bite ID</h1>
				<!-- Name of the header at the top of the page -->
		</div><!-- /header -->
		<div role="main" class="ui-content">
			<p>
				This website will help to determine which insect has bitten you.
				<br>Start by uploading a picture of your bite!
			</p>
	<!-- comment out the part that prompt the user to select and upload an image
			<div>
			Press "Choose File" to create or choose image file:
			<input type="file" id="fileInput" STYLE="background-color: #FF6600;">
			</div>
		
		<div id="messageDisplayArea"></div>
		
		<canvas id="myCanvas" width=600 height=500 paddle: 0 margin: auto style="border:1px solid #d3d3d3;" ></canvas>
		<script> /* This script initiates the cavas and puts the text on the canvas "myCanvas" */
		var canvas = document.getElementById('myCanvas');// get canvas by id "myCanvas"
		var context = canvas.getContext("2d");// set canvas element to 2D.
		context.font = '20pt Calibri'; // set displayed text in canvas context to 20pt Calibri font
		context.fillStyle = "black";// set displayed text in canvas context to black
		context.fillText("Picture of your bite will be displayed here.", 10, 20); // state displayed text content and position. 
		</script>
	-->
		<p> Click  START  to start the survey after your image is uploaded. </p>  
			<!-- content shown on title page, break is added by using <br> in each line-->
		<a href="#Q1" data-role="button">START</a>	
			<!-- Add a button that links to question 1 -->
			<!-- on click, this will launch to the first page of the survey.-->
			
		</div><!-- /content -->
		
		<div data-role="footer" data-position="fixed">
			<p style="color:red;">Please note that this website does not store any information.</p><!-- privacy statement-->
			<h4>DIY Diagnostics</h4>
		</div><!-- /footer -->
	</div><!-- /intro page -->

<!-- Question 1 of survey-->
	<div data-role="page" id="Q1">
		<div data-role="header">
			<h1>Bug Bite ID</h1>
			<!-- Name of the header at the top of the page -->
		</div><!-- /header -->
		<div data-role="content">
			<p>Where is the bite located on your body? <br> Please select the location of your bite.</p>
			<!-- checkboxes-->
			<ul><!--unorderd bulleted list-->
				<label><input class="checkbox" type="checkbox" name="Leg[]" id="leg"> Legs/ankles </label>
			    	<label><input class="checkbox" type="checkbox" name="Arm[]" id="arm"> Arms </label>
			    	<label><input class="checkbox" type="checkbox" name="Folds[]" id="fold"> Folds of skin (e.g. inner elbow, behind your knee)</label>
			    	<label><input class="checkbox" type="checkbox" name="Face[]" id="face"> Face </label>
			    	<label><input class="checkbox" type="checkbox" name="Back[]" id="back"> Back </label>
		            	<label><input class="checkbox" type="checkbox" name="Torso[]" id="torso"> Torso </label>
				<label><input class="checkbox" type="checkbox" name="Neck[]" id="neck"> Neck </label>
			</ul><!-- end of list-->
			<a href="#Q2" data-role="button" style="float:right">Next</a> <!-- link to next page-->
		</div><!-- /content -->
		<div data-role="footer" data-position="fixed">
			<p style="color:red;">Please note that this website does not store any information.</p><!-- privacy statement-->
			<h4>DIY Diagnostics</h4>
		</div><!-- /footer -->
	</div><!--/question 1--> 
<!-- Question 2 of survey-->
	<div data-role="page" id="Q2">
		<div data-role="header">
			<h1>Bug Bite ID</h1>
			<!-- Name of the header at the top of the page -->
		</div><!-- /header -->
		<div data-role="content">
			<p>What does your bite(s) look like? <br> Please select the appearances that apply to the bite(s) you have.</p>
			<!-- checkboxes-->
			<ul><!--unorderd bulleted list-->
			    	<label><input class="checkbox" type="checkbox" name="check[]" id="bump"> Bump </label>
				<label><input class="checkbox" type="checkbox" name="check[]" id="redspot"> Red spot </label>
			    	<label><input class="checkbox" type="checkbox" name="check[]" id="mark"> Bite mark </label>
			    	<label><input class="checkbox" type="checkbox" name="check[]" id="cluster"> Clustered in group</label>
			    	<label><input class="checkbox" type="checkbox" name="check[]" id="line"> Form a line </label>
			    	<label><input class="checkbox" type="checkbox" name="check[]" id="stinger"> Stinger presented </label>
				<label><input class="checkbox" type="checkbox" name="check[]" id="tick"> Bug/tick presented on bite </label>
				<label><input class="checkbox" type="checkbox" name="check[]" id="bullrash"> Bull's eye rash </label>
				<label><input class="checkbox" type="checkbox" name="check[]" id="blister"> Blister </label>
				<label><input class="checkbox" type="checkbox" name="check[]" id="puncmarks"> 2 puncture marks </label>
				<label><input class="checkbox" type="checkbox" name="check[]" id="blue"> Blue/purple-ish color around the bite </label>
			</ul><!-- end of list-->
			<a href="#Q3" data-role="button" style="float:right">Next</a> <!-- link to next page-->
		</div><!-- /content -->
		<div data-role="footer" data-position="fixed">
			<p style="color:red;">Please note that this website does not store any information.</p><!-- privacy statement-->
			<h4>DIY Diagnostics</h4>
		</div><!-- /footer -->
	</div><!--/question 2--> 
<!-- Question 3 of survey-->
	<div data-role="page" id="Q3">
		<div data-role="header">
			<h1>Bug Bite ID</h1>
			<!-- Name of the header at the top of the page -->
		</div><!-- /header -->
		<div data-role="content">
			<p>What symptoms do you have? <br>Please select the symptoms associate to the bite(s) you have.</p>
			<!-- checkboxes-->
			<ul><!--unorderd bulleted list-->
			    	<label><input class="checkbox" type="checkbox" name="check[]" id="itch"> Itch </label>
			    	<label><input class="checkbox" type="checkbox" name="check[]" id="pain"> Pain </label>
			    	<label><input class="checkbox" type="checkbox" name="check[]" id="burn"> Burning sensation</label>
			    	<label><input class="checkbox" type="checkbox" name="check[]" id="fever"> Fever </label>
			</ul><!-- end of list-->
			<a href="#results" data-role="button" style="float:right">Next</a> <!-- link to next page-->
		</div><!-- /content -->
		<div data-role="footer" data-position="fixed">
			<p style="color:red;">Please note that this website does not store any information.</p><!-- privacy statement-->
			<h4>DIY Diagnostics</h4>
		</div><!-- /footer -->
	</div><!--/question 3--> 
<!--Results-->
	<div data-role="page" id="results">
		<div data-role="header">
			<h1>Bug Bite ID</h1>
			<!-- Name of the header at the top of the page -->
		</div><!-- /header -->
		<div role="main" class="ui-content">
			<p id="resultText"> </p> 
			<a onclick= "CalcResults();showResults();" data-role="button"> Click here to view your results!</a>
			<p> Does the image present here look similar to the bite you have? </p> 
			<p id="resultImg"> </p>
			<a href="#yes" data-role="button">Yes</a>
			<a href="#no" data-role="button">No</a> 
			
		</div><!-- /content -->
		<div data-role="footer">
			<p style="color:red;">Please note that this website does not store any information.</p><!-- privacy statement-->
			<h4>DIY Diagnostics</h4>
		</div><!-- /footer -->
	</div><!--/Results--> 
	<!-- this page is for when the user clicks yes in the results -->
<div data-role="page" id="yes">
		<div data-role="header">
			<h1>Bug Bite ID</h1>
			<!-- Name of the header at the top of the page -->
		</div><!-- /header -->
		<div data-role="content">
			<p>Thank you for taking the survey.<br> Based on your results, there is a possibility of having (LIST DISEASES HERE)</p>
			
		</div><!-- /content -->
		<div data-role="footer" data-position="fixed">
			<p style="color:red;">Please note that this website does not store any information.</p><!-- privacy statement-->
			<h4>DIY Diagnostics</h4>
		</div><!-- /footer -->
	</div><!--/page for when user clicks yes--> 
<!-- this page is for when the user clicks no in the results -->
<div data-role="page" id="no">
		<div data-role="header">
			<h1>Bug Bite ID</h1>
			<!-- Name of the header at the top of the page -->
		</div><!-- /header -->
		<div data-role="content">
			<p>Please choose a photo that corresponds with your bite.</p>
			
		</div><!-- /content -->
		<div data-role="footer" data-position="fixed">
			<p style="color:red;">Please note that this website does not store any information.</p><!-- privacy statement-->
			<h4>DIY Diagnostics</h4>
		</div><!-- /footer -->
	</div><!--/page for when user clicks no--> 
</body>
</html>
